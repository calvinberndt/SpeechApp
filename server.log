INFO:backend.chatterbox_tts_processor:Applied torch.load patch for mps compatibility
INFO:     Will watch for changes in these directories: ['/Users/calvinberndt/_GitHub/SpeechApp']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [9440] using WatchFiles
INFO:watchfiles.main:6 changes detected
INFO:watchfiles.main:8 changes detected
INFO:watchfiles.main:2 changes detected
INFO:backend.chatterbox_tts_processor:Applied torch.load patch for mps compatibility
INFO:     Started server process [9508]
INFO:     Waiting for application startup.
INFO:backend.speech_processor:Initializing Kyutai STT model...
INFO:watchfiles.main:1 change detected
INFO:backend.speech_processor:Kyutai STT model initialized successfully
INFO:backend.llm_client:Checking Ollama server at http://localhost:11434...
INFO:backend.llm_client:Found model: openhermes:latest
INFO:backend.llm_client:LLM client initialized with model: openhermes
INFO:backend.chatterbox_tts_processor:Initializing Chatterbox TTS model on mps...
INFO:watchfiles.main:5 changes detected
/Users/calvinberndt/_GitHub/SpeechApp/.venv/lib/python3.11/site-packages/diffusers/models/lora.py:393: FutureWarning: `LoRACompatibleLinear` is deprecated and will be removed in version 1.0.0. Use of `LoRACompatibleLinear` is deprecated. Please switch to PEFT backend by installing PEFT: `pip install peft`.
  deprecate("LoRACompatibleLinear", "1.0.0", deprecation_message)
INFO:root:input frame rate=25
INFO:backend.chatterbox_tts_processor:Applying performance optimizations for mps...
INFO:backend.chatterbox_tts_processor:Moved all model components to MPS device (without half precision to avoid type conflicts)
INFO:backend.chatterbox_tts_processor:Applied torch.compile to T3 model
INFO:backend.chatterbox_tts_processor:Applied torch.compile to S3Gen model
INFO:backend.chatterbox_tts_processor:Applied aggressive speed optimization to T3 inference
INFO:backend.chatterbox_tts_processor:✅ Chatterbox TTS model initialized successfully on mps
INFO:     Application startup complete.
loaded PerthNet (Implicit) at step 250,000
INFO:     127.0.0.1:54289 - "GET / HTTP/1.1" 200 OK
INFO:     ('127.0.0.1', 54291) - "WebSocket /ws/user-7867" [accepted]
INFO:main:Client user-7867 connected
INFO:     connection open
INFO:backend.llm_client:Generated response: Hello! How can I assist you today?...
INFO:backend.chatterbox_tts_processor:Generating TTS for: Hello! How can I assist you today?...
INFO:backend.chatterbox_tts_processor:Applied fast mode parameters: ['text', 'exaggeration', 'cfg_weight', 'temperature', 'min_p', 'top_p', 'repetition_penalty']
INFO:backend.chatterbox_tts_processor:Calling ChatterboxTTS.generate with parameters: ['text', 'exaggeration', 'cfg_weight', 'temperature', 'min_p', 'top_p', 'repetition_penalty']
/opt/anaconda3/lib/python3.11/contextlib.py:105: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
LlamaModel is using LlamaSdpaAttention, but `torch.nn.functional.scaled_dot_product_attention` does not support `output_attentions=True`. Falling back to the manual attention implementation, but specifying the manual implementation will be required from Transformers version v5.0.0 onwards. This warning can be removed using the argument `attn_implementation="eager"` when loading the model.
Sampling:   0%|          | 0/600 [00:00<?, ?it/s]We detected that you are passing `past_key_values` as a tuple of tuples. This is deprecated and will be removed in v4.47. Please convert your cache or use an appropriate `Cache` class (https://huggingface.co/docs/transformers/kv_cache#legacy-cache-format)
Sampling:   0%|          | 1/600 [00:00<05:36,  1.78it/s]Sampling:   0%|          | 2/600 [00:00<02:54,  3.43it/s]Sampling:   1%|          | 4/600 [00:00<01:40,  5.92it/s]Sampling:   1%|          | 6/600 [00:01<01:18,  7.58it/s]Sampling:   1%|▏         | 8/600 [00:01<01:08,  8.63it/s]Sampling:   2%|▏         | 10/600 [00:01<01:03,  9.28it/s]Sampling:   2%|▏         | 12/600 [00:01<01:00,  9.69it/s]Sampling:   2%|▏         | 14/600 [00:01<00:58, 10.09it/s]Sampling:   3%|▎         | 16/600 [00:01<00:56, 10.36it/s]Sampling:   3%|▎         | 18/600 [00:02<00:54, 10.63it/s]Sampling:   3%|▎         | 20/600 [00:02<00:54, 10.71it/s]Sampling:   4%|▎         | 22/600 [00:02<00:53, 10.71it/s]Sampling:   4%|▍         | 24/600 [00:02<00:54, 10.66it/s]Sampling:   4%|▍         | 26/600 [00:02<00:54, 10.55it/s]Sampling:   5%|▍         | 28/600 [00:03<00:53, 10.66it/s]Sampling:   5%|▌         | 30/600 [00:03<01:01,  9.30it/s]Sampling:   5%|▌         | 31/600 [00:03<01:01,  9.26it/s]Sampling:   5%|▌         | 32/600 [00:03<01:00,  9.33it/s]Sampling:   6%|▌         | 33/600 [00:03<01:05,  8.60it/s]Sampling:   6%|▌         | 34/600 [00:03<01:04,  8.78it/s]Sampling:   6%|▌         | 36/600 [00:04<01:01,  9.13it/s]Sampling:   6%|▌         | 37/600 [00:04<01:01,  9.11it/s]Sampling:   6%|▋         | 38/600 [00:04<01:03,  8.85it/s]Sampling:   6%|▋         | 39/600 [00:04<01:04,  8.75it/s]Sampling:   7%|▋         | 40/600 [00:04<01:02,  8.90it/s]Sampling:   7%|▋         | 41/600 [00:04<01:04,  8.63it/s]Sampling:   7%|▋         | 42/600 [00:04<01:04,  8.59it/s]Sampling:   7%|▋         | 43/600 [00:05<01:44,  5.31it/s]Sampling:   7%|▋         | 44/600 [00:05<01:35,  5.83it/s]Sampling:   8%|▊         | 45/600 [00:05<01:25,  6.49it/s]Sampling:   8%|▊         | 46/600 [00:05<01:19,  7.00it/s]Sampling:   8%|▊         | 47/600 [00:05<01:13,  7.49it/s]Sampling:   8%|▊         | 48/600 [00:05<01:08,  8.09it/s]Sampling:   8%|▊         | 49/600 [00:05<01:06,  8.31it/s]Sampling:   8%|▊         | 50/600 [00:05<01:08,  8.05it/s]Sampling:   8%|▊         | 51/600 [00:06<01:05,  8.35it/s]Sampling:   8%|▊         | 51/600 [00:06<01:05,  8.42it/s]
INFO:watchfiles.main:26 changes detected
INFO:watchfiles.main:18 changes detected
INFO:backend.chatterbox_tts_processor:Audio tensor shape: torch.Size([1, 48960]), sample_rate: 24000
INFO:backend.chatterbox_tts_processor:✅ TTS audio saved to audio_files/chatterbox_5258.wav
INFO:     127.0.0.1:54290 - "GET / HTTP/1.1" 200 OK
INFO:     127.0.0.1:54295 - "GET /health HTTP/1.1" 200 OK
INFO:     127.0.0.1:54297 - "GET /audio/chatterbox_5258.wav HTTP/1.1" 206 Partial Content
INFO:     127.0.0.1:54297 - "GET /favicon.ico HTTP/1.1" 404 Not Found
INFO:watchfiles.main:1 change detected
INFO:     127.0.0.1:54300 - "GET / HTTP/1.1" 200 OK
INFO:     ('127.0.0.1', 54303) - "WebSocket /ws/user-6526" [accepted]
INFO:main:Client user-6526 connected
INFO:     connection open
INFO:backend.llm_client:Generated response: The sky appears blue because of a phenomenon calle...
INFO:backend.chatterbox_tts_processor:Generating TTS for: The sky appears blue because of a phenomenon called Rayleigh scattering. Sunlight, which is composed...
INFO:backend.chatterbox_tts_processor:Split text into 5 chunks for faster processing
INFO:backend.chatterbox_tts_processor:Processing chunk 1/5: The sky appears blue because of a phenomenon calle...
INFO:backend.chatterbox_tts_processor:Applied fast mode parameters: ['text', 'exaggeration', 'cfg_weight', 'temperature', 'min_p', 'top_p', 'repetition_penalty']
INFO:backend.chatterbox_tts_processor:Calling ChatterboxTTS.generate with parameters: ['text', 'exaggeration', 'cfg_weight', 'temperature', 'min_p', 'top_p', 'repetition_penalty']
/opt/anaconda3/lib/python3.11/contextlib.py:105: FutureWarning: `torch.backends.cuda.sdp_kernel()` is deprecated. In the future, this context manager will be removed. Please see `torch.nn.attention.sdpa_kernel()` for the new context manager, with updated signature.
  self.gen = func(*args, **kwds)
Sampling:   0%|          | 0/600 [00:00<?, ?it/s]Sampling:   0%|          | 1/600 [00:00<01:32,  6.46it/s]Sampling:   0%|          | 2/600 [00:00<02:04,  4.81it/s]Sampling:   0%|          | 3/600 [00:00<02:14,  4.44it/s]Sampling:   1%|          | 4/600 [00:00<01:50,  5.38it/s]Sampling:   1%|          | 5/600 [00:00<01:51,  5.35it/s]Sampling:   1%|          | 6/600 [00:01<01:50,  5.36it/s]Sampling:   1%|          | 7/600 [00:01<01:49,  5.44it/s]Sampling:   1%|▏         | 8/600 [00:01<01:50,  5.34it/s]Sampling:   2%|▏         | 9/600 [00:01<01:50,  5.35it/s]Sampling:   2%|▏         | 10/600 [00:01<02:05,  4.68it/s]Sampling:   2%|▏         | 11/600 [00:02<02:09,  4.54it/s]Sampling:   2%|▏         | 12/600 [00:02<02:05,  4.68it/s]Sampling:   2%|▏         | 13/600 [00:02<02:14,  4.37it/s]Sampling:   2%|▏         | 14/600 [00:02<02:23,  4.07it/s]Sampling:   2%|▎         | 15/600 [00:03<02:27,  3.97it/s]Sampling:   3%|▎         | 16/600 [00:03<02:30,  3.88it/s]Sampling:   3%|▎         | 17/600 [00:03<02:17,  4.23it/s]Sampling:   3%|▎         | 18/600 [00:03<02:25,  4.00it/s]Sampling:   3%|▎         | 19/600 [00:04<02:00,  4.81it/s]Sampling:   3%|▎         | 20/600 [00:04<01:55,  5.00it/s]Sampling:   4%|▎         | 21/600 [00:04<01:52,  5.16it/s]Sampling:   4%|▎         | 22/600 [00:04<01:48,  5.33it/s]Sampling:   4%|▍         | 23/600 [00:04<01:34,  6.12it/s]Sampling:   4%|▍         | 24/600 [00:04<01:41,  5.70it/s]Sampling:   4%|▍         | 25/600 [00:05<01:40,  5.74it/s]Sampling:   4%|▍         | 27/600 [00:05<01:12,  7.94it/s]Sampling:   5%|▍         | 29/600 [00:05<01:01,  9.23it/s]Sampling:   5%|▌         | 31/600 [00:05<00:54, 10.48it/s]Sampling:   6%|▌         | 33/600 [00:05<00:49, 11.43it/s]Sampling:   6%|▌         | 35/600 [00:05<00:47, 11.87it/s]Sampling:   6%|▌         | 37/600 [00:06<00:47, 11.93it/s]Sampling:   6%|▋         | 39/600 [00:06<00:45, 12.24it/s]Sampling:   7%|▋         | 41/600 [00:06<00:46, 12.14it/s]Sampling:   7%|▋         | 43/600 [00:06<00:45, 12.36it/s]Sampling:   8%|▊         | 45/600 [00:06<01:01,  9.03it/s]Sampling:   8%|▊         | 47/600 [00:07<00:56,  9.86it/s]Sampling:   8%|▊         | 49/600 [00:07<00:52, 10.51it/s]Sampling:   8%|▊         | 51/600 [00:07<00:52, 10.47it/s]Sampling:   9%|▉         | 53/600 [00:07<01:04,  8.45it/s]Sampling:   9%|▉         | 54/600 [00:07<01:04,  8.50it/s]Sampling:   9%|▉         | 55/600 [00:07<01:04,  8.47it/s]Sampling:   9%|▉         | 56/600 [00:08<01:03,  8.56it/s]Sampling:  10%|▉         | 57/600 [00:08<01:03,  8.58it/s]Sampling:  10%|▉         | 58/600 [00:08<01:03,  8.52it/s]Sampling:  10%|▉         | 59/600 [00:08<01:04,  8.34it/s]Sampling:  10%|█         | 60/600 [00:08<01:16,  7.08it/s]Sampling:  10%|█         | 61/600 [00:08<01:16,  7.05it/s]Sampling:  10%|█         | 62/600 [00:09<02:01,  4.44it/s]Sampling:  10%|█         | 63/600 [00:09<01:48,  4.94it/s]Sampling:  11%|█         | 64/600 [00:09<01:41,  5.30it/s]Sampling:  11%|█         | 65/600 [00:09<01:35,  5.58it/s]Sampling:  11%|█         | 66/600 [00:09<01:31,  5.85it/s]Sampling:  11%|█         | 67/600 [00:09<01:29,  5.98it/s]Sampling:  11%|█▏        | 68/600 [00:10<01:29,  5.96it/s]Sampling:  12%|█▏        | 69/600 [00:10<01:21,  6.50it/s]Sampling:  12%|█▏        | 70/600 [00:10<01:20,  6.61it/s]Sampling:  12%|█▏        | 71/600 [00:10<01:19,  6.69it/s]Sampling:  12%|█▏        | 72/600 [00:10<01:16,  6.92it/s]Sampling:  12%|█▏        | 73/600 [00:10<01:17,  6.83it/s]Sampling:  12%|█▏        | 74/600 [00:10<01:16,  6.88it/s]Sampling:  12%|█▎        | 75/600 [00:11<01:16,  6.84it/s]Sampling:  13%|█▎        | 76/600 [00:11<01:25,  6.13it/s]Sampling:  13%|█▎        | 77/600 [00:11<01:28,  5.88it/s]Sampling:  13%|█▎        | 78/600 [00:11<01:21,  6.43it/s]Sampling:  13%|█▎        | 79/600 [00:11<01:16,  6.81it/s]Sampling:  13%|█▎        | 80/600 [00:11<01:13,  7.03it/s]Sampling:  14%|█▎        | 81/600 [00:11<01:10,  7.34it/s]Sampling:  14%|█▎        | 82/600 [00:12<01:07,  7.62it/s]Sampling:  14%|█▍        | 83/600 [00:12<01:13,  7.06it/s]Sampling:  14%|█▍        | 84/600 [00:12<01:09,  7.39it/s]Sampling:  14%|█▍        | 85/600 [00:12<01:06,  7.71it/s]Sampling:  14%|█▍        | 86/600 [00:12<01:11,  7.22it/s]Sampling:  14%|█▍        | 87/600 [00:12<01:14,  6.91it/s]Sampling:  15%|█▍        | 88/600 [00:13<01:21,  6.27it/s]Sampling:  15%|█▍        | 89/600 [00:13<01:21,  6.25it/s]Sampling:  15%|█▌        | 90/600 [00:13<01:25,  5.98it/s]Sampling:  15%|█▌        | 91/600 [00:13<01:20,  6.33it/s]Sampling:  15%|█▌        | 92/600 [00:13<01:27,  5.82it/s]Sampling:  16%|█▌        | 93/600 [00:13<01:43,  4.92it/s]Sampling:  16%|█▌        | 94/600 [00:14<01:45,  4.81it/s]Sampling:  16%|█▌        | 95/600 [00:14<01:39,  5.09it/s]Sampling:  16%|█▌        | 95/600 [00:14<01:16,  6.59it/s]
INFO:backend.chatterbox_tts_processor:Processing chunk 2/5: Sunlight, which is composed of different colors or...
INFO:backend.chatterbox_tts_processor:Applied fast mode parameters: ['text', 'exaggeration', 'cfg_weight', 'temperature', 'min_p', 'top_p', 'repetition_penalty']
INFO:backend.chatterbox_tts_processor:Calling ChatterboxTTS.generate with parameters: ['text', 'exaggeration', 'cfg_weight', 'temperature', 'min_p', 'top_p', 'repetition_penalty']
Sampling:   0%|          | 0/600 [00:00<?, ?it/s]Sampling:   0%|          | 1/600 [00:00<01:14,  8.02it/s]Sampling:   0%|          | 2/600 [00:00<02:02,  4.90it/s]Sampling:   0%|          | 3/600 [00:00<01:48,  5.48it/s]Sampling:   1%|          | 4/600 [00:00<02:15,  4.40it/s]Sampling:   1%|          | 5/600 [00:01<03:20,  2.96it/s]Sampling:   1%|          | 6/600 [00:01<03:12,  3.09it/s]Sampling:   1%|          | 7/600 [00:01<03:12,  3.08it/s]Sampling:   1%|▏         | 8/600 [00:02<02:44,  3.60it/s]Sampling:   2%|▏         | 9/600 [00:02<02:24,  4.10it/s]Sampling:   2%|▏         | 10/600 [00:02<02:24,  4.08it/s]Sampling:   2%|▏         | 11/600 [00:02<02:18,  4.26it/s]Sampling:   2%|▏         | 12/600 [00:02<02:00,  4.88it/s]Sampling:   2%|▏         | 13/600 [00:03<02:02,  4.78it/s]Sampling:   2%|▏         | 14/600 [00:03<01:56,  5.03it/s]Sampling:   3%|▎         | 16/600 [00:03<01:25,  6.82it/s]Sampling:   3%|▎         | 18/600 [00:03<01:14,  7.80it/s]Sampling:   3%|▎         | 20/600 [00:03<01:05,  8.91it/s]Sampling:   4%|▎         | 22/600 [00:04<00:58,  9.83it/s]Sampling:   4%|▍         | 24/600 [00:04<01:08,  8.38it/s]Sampling:   4%|▍         | 25/600 [00:04<01:09,  8.32it/s]Sampling:   4%|▍         | 27/600 [00:04<01:02,  9.21it/s]